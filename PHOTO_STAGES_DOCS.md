# –°–∏—Å—Ç–µ–º–∞ —Ñ–æ—Ç–æ—Ñ–∏–∫—Å–∞—Ü–∏–∏ —ç—Ç–∞–ø–æ–≤ –¥–æ—Å—Ç–∞–≤–∫–∏

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ —Ä–µ—à–µ–Ω–∏—è

### –§–ª–æ—É –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑–∞

```
1. –ó–∞–∫–∞–∑ —Å–æ–∑–¥–∞–Ω (status: pending)
   ‚Üì
2. –í–æ–¥–∏—Ç–µ–ª—å –Ω–∞–∑–Ω–∞—á–µ–Ω (status: in_progress)
   ‚Üì
3. –í–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –ó–ê–ì–†–£–ó–ö–£ + —Ñ–æ—Ç–æ (status: in_progress, loading_confirmed_at —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
   ‚Üì
4. –í–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –í–´–ì–†–£–ó–ö–£ + —Ñ–æ—Ç–æ (status: in_progress, unloading_confirmed_at —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
   ‚Üì
5. –í–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (status: in_progress, driver_completed_at —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è)
   ‚Üì
6. –ó–∞–∫–∞–∑—á–∏–∫ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–∞–µ—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ (status: closed)
```

### –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

#### –¢–∞–±–ª–∏—Ü–∞ `order_photos`
- `id` - INTEGER PRIMARY KEY
- `order_id` - INTEGER (FK to orders)
- `photo_type` - TEXT ('loading' –∏–ª–∏ 'unloading')
- `file_path` - TEXT (–ø—É—Ç—å –∫ —Ñ–∞–π–ª—É –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ)
- `telegram_file_id` - TEXT (ID —Ñ–∞–π–ª–∞ –≤ Telegram –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è)
- `uploaded_by` - INTEGER (FK to users)
- `uploaded_at` - TIMESTAMP

#### –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –∫–æ–ª–æ–Ω–∫–∏ –≤ `orders`
- `loading_confirmed_at` - TIMESTAMP (–∫–æ–≥–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –∑–∞–≥—Ä—É–∑–∫—É)
- `unloading_confirmed_at` - TIMESTAMP (–∫–æ–≥–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –≤—ã–≥—Ä—É–∑–∫—É)
- `driver_completed_at` - TIMESTAMP (–∫–æ–≥–¥–∞ –≤–æ–¥–∏—Ç–µ–ª—å –ø–æ–¥—Ç–≤–µ—Ä–¥–∏–ª –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ)

### API Endpoints

#### 1. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏
```
POST /api/orders/{order_id}/photos/loading
Headers: telegram_id
Body: multipart/form-data with photos[]
Response: { success: true, photo_ids: [1, 2, 3] }
```

#### 2. –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤—ã–≥—Ä—É–∑–∫–∏
```
POST /api/orders/{order_id}/photos/unloading  
Headers: telegram_id
Body: multipart/form-data with photos[]
Response: { success: true, photo_ids: [4, 5, 6] }
```

#### 3. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–æ—Ç–æ –∑–∞–∫–∞–∑–∞
```
GET /api/orders/{order_id}/photos
Headers: telegram_id
Response: {
  loading: [{id, file_path, uploaded_at}, ...],
  unloading: [{id, file_path, uploaded_at}, ...]
}
```

#### 4. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ñ–∞–π–ª–∞ —Ñ–æ—Ç–æ
```
GET /api/photos/{photo_id}
Headers: telegram_id
Response: image file (—Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞)
```

### Telegram Bot Handlers

#### –ü–æ—Å–ª–µ –Ω–∞–∑–Ω–∞—á–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É: **"üì¶ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –∑–∞–≥—Ä—É–∑–∫—É"**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:
1. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ —á–µ—Ä–µ–∑ `request_photo()`
2. –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 1-5 —Ñ–æ—Ç–æ
3. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ API `/api/orders/{id}/photos/loading`
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `loading_confirmed_at`
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞: **"üì§ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≥—Ä—É–∑–∫—É"**

#### –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏
–ü–æ–∫–∞–∑—ã–≤–∞–µ–º –∫–Ω–æ–ø–∫—É: **"üì§ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–≥—Ä—É–∑–∫—É"**

–ü—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏:
1. –ë–æ—Ç –∑–∞–ø—Ä–∞—à–∏–≤–∞–µ—Ç —Ñ–æ—Ç–æ
2. –í–æ–¥–∏—Ç–µ–ª—å –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç 1-5 —Ñ–æ—Ç–æ
3. –ë–æ—Ç —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç —á–µ—Ä–µ–∑ API `/api/orders/{id}/photos/unloading`
4. –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è `unloading_confirmed_at`
5. –ü–æ–∫–∞–∑—ã–≤–∞–µ—Ç—Å—è –∫–Ω–æ–ø–∫–∞: **"‚úÖ –ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ"**

### WebApp UI

#### –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –≤–æ–¥–∏—Ç–µ–ª—è
- –ü–æ–∫–∞–∑—ã–≤–∞—Ç—å —Å—Ç–∞—Ç—É—Å: "–û–∂–∏–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏", "–ó–∞–≥—Ä—É–∂–µ–Ω–æ", "–í –ø—É—Ç–∏", "–í—ã–≥—Ä—É–∂–µ–Ω–æ"
- –°–µ–∫—Ü–∏—è "–§–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏" —Å –≥–∞–ª–µ—Ä–µ–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –°–µ–∫—Ü–∏—è "–§–æ—Ç–æ –≤—ã–≥—Ä—É–∑–∫–∏" —Å –≥–∞–ª–µ—Ä–µ–µ–π (–µ—Å–ª–∏ –µ—Å—Ç—å)
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ" –¥–æ—Å—Ç—É–ø–Ω–∞ —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ unloading_confirmed_at

#### –ö–∞—Ä—Ç–æ—á–∫–∞ –∑–∞–∫–∞–∑–∞ –¥–ª—è –∑–∞–∫–∞–∑—á–∏–∫–∞
- –ü—Ä–æ—Å–º–æ—Ç—Ä —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏ –∏ –≤—ã–≥—Ä—É–∑–∫–∏
- –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å –≤—ã–ø–æ–ª–Ω–µ–Ω–∏–µ" **–ó–ê–ë–õ–û–ö–ò–†–û–í–ê–ù–ê** –ø–æ–∫–∞ driver_completed_at == NULL
- –ü–æ—Å–ª–µ driver_completed_at –∫–Ω–æ–ø–∫–∞ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –∞–∫—Ç–∏–≤–Ω–æ–π

### –ü—Ä–æ–≤–µ—Ä–∫–∏ –∏ –≤–∞–ª–∏–¥–∞—Ü–∏—è

1. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –∑–∞–≥—Ä—É–∑–∫–∏:**
   - –¢–æ–ª—å–∫–æ –≤–æ–¥–∏—Ç–µ–ª—å, –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–π –Ω–∞ –∑–∞–∫–∞–∑
   - –ó–∞–∫–∞–∑ –≤ —Å—Ç–∞—Ç—É—Å–µ 'in_progress'
   - –ú–∏–Ω–∏–º—É–º 1 —Ñ–æ—Ç–æ, –º–∞–∫—Å–∏–º—É–º 5

2. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ –≤—ã–≥—Ä—É–∑–∫–∏:**
   - –¢–æ–ª—å–∫–æ –≤–æ–¥–∏—Ç–µ–ª—å
   - loading_confirmed_at –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - –ú–∏–Ω–∏–º—É–º 1 —Ñ–æ—Ç–æ, –º–∞–∫—Å–∏–º—É–º 5

3. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª–µ–º:**
   - unloading_confirmed_at –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç driver_completed_at

4. **–ü–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–æ–º:**
   - driver_completed_at –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω
   - –ü–µ—Ä–µ–≤–æ–¥–∏—Ç –∑–∞–∫–∞–∑ –≤ status='closed'

### –•—Ä–∞–Ω–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤

```
/app/data/photos/
  ‚îú‚îÄ‚îÄ {order_id}/
  ‚îÇ   ‚îú‚îÄ‚îÄ loading/
  ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ {timestamp}_{photo_id}.jpg
  ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ ...
  ‚îÇ   ‚îî‚îÄ‚îÄ unloading/
  ‚îÇ       ‚îú‚îÄ‚îÄ {timestamp}_{photo_id}.jpg
  ‚îÇ       ‚îî‚îÄ‚îÄ ...
```

### –ë–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å

- –ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞ –∫ —Ñ–æ—Ç–æ (—Ç–æ–ª—å–∫–æ —É—á–∞—Å—Ç–Ω–∏–∫–∏ –∑–∞–∫–∞–∑–∞)
- –í–∞–ª–∏–¥–∞—Ü–∏—è file types (—Ç–æ–ª—å–∫–æ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è)
- –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ —Ñ–∞–π–ª–æ–≤ (–º–∞–∫—Å 10MB –Ω–∞ —Ñ–æ—Ç–æ)
- –ü—Ä–æ–≤–µ—Ä–∫–∞ —á—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å - —É—á–∞—Å—Ç–Ω–∏–∫ –∑–∞–∫–∞–∑–∞ –ø–µ—Ä–µ–¥ –æ—Ç–¥–∞—á–µ–π —Ñ–∞–π–ª–∞

## –°—Ç–∞—Ç—É—Å—ã –∑–∞–∫–∞–∑–∞

–¢–µ–∫—É—â–∏–µ —Å—Ç–∞—Ç—É—Å—ã –æ—Å—Ç–∞—é—Ç—Å—è, –Ω–æ –¥–æ–±–∞–≤–ª—è–µ—Ç—Å—è –ª–æ–≥–∏–∫–∞ –ø—Ä–æ–≤–µ—Ä–æ–∫:
- `pending` - –æ–∂–∏–¥–∞–µ—Ç –∏—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—è
- `in_progress` - –Ω–∞–∑–Ω–∞—á–µ–Ω –≤–æ–¥–∏—Ç–µ–ª—å
  - `loading_confirmed_at` NULL ‚Üí "–û–∂–∏–¥–∞–µ—Ç –∑–∞–≥—Ä—É–∑–∫–∏"
  - `loading_confirmed_at` SET, `unloading_confirmed_at` NULL ‚Üí "–í –ø—É—Ç–∏"  
  - `unloading_confirmed_at` SET, `driver_completed_at` NULL ‚Üí "–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤–æ–¥–∏—Ç–µ–ª—è"
  - `driver_completed_at` SET ‚Üí "–û–∂–∏–¥–∞–µ—Ç –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –∑–∞–∫–∞–∑—á–∏–∫–∞"
- `closed` - –≤—ã–ø–æ–ª–Ω–µ–Ω –æ–±–µ–∏–º–∏ —Å—Ç–æ—Ä–æ–Ω–∞–º–∏

## –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–∞–º

### –§–∞–∑–∞ 1 (–∫—Ä–∏—Ç–∏—á–Ω–∞—è):
1. ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –ë–î
2. API endpoints –¥–ª—è –∑–∞–≥—Ä—É–∑–∫–∏/–ø–æ–ª—É—á–µ–Ω–∏—è —Ñ–æ—Ç–æ
3. –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ª–æ–≥–∏–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

### –§–∞–∑–∞ 2:
4. Telegram bot handlers
5. WebApp UI –¥–ª—è –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è —Ñ–æ—Ç–æ
6. –ë–ª–æ–∫–∏—Ä–æ–≤–∫–∞ –∫–Ω–æ–ø–∫–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è

### –§–∞–∑–∞ 3:
7. –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–ª–Ω–æ–≥–æ —Ñ–ª–æ—É
8. –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
