<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
    <meta http-equiv="Pragma" content="no-cache">
    <meta http-equiv="Expires" content="0">
    <title>FreightHub</title>
    <link rel="stylesheet" href="static/css/style.css?v={{ version }}">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
</head>
<body>
    <div id="app">
        <!-- Экран загрузки -->
        <div id="loading-screen" class="screen">
            <div class="loading-container">
                <div class="logo">FH</div>
                <h1>FreightHub</h1>
                <div class="spinner"></div>
                <p id="loading-text">Загрузка...</p>
            </div>
        </div>

        <!-- Экран регистрации -->
        <div id="registration-screen" class="screen hidden">
            <div class="container">
                <div class="logo-section">
                    <div class="logo">FH</div>
                    <h1>FreightHub</h1>
                    <p class="subtitle">Сервис грузоперевозок</p>
                </div>

                <div class="registration-form">
                    <h2>Требуется регистрация</h2>
                    <p class="description">
                        Для использования приложения необходимо зарегистрироваться через Telegram бота.
                    </p>

                    <div class="info-block" style="background: var(--tg-theme-secondary-bg-color, #f0f0f0); padding: 20px; border-radius: 12px; margin: 20px 0;">
                        <p style="margin: 10px 0;"><strong>Шаг 1:</strong> Найдите бота <strong>@freighthub_bot</strong></p>
                        <p style="margin: 10px 0;"><strong>Шаг 2:</strong> Отправьте команду <strong>/start</strong></p>
                        <p style="margin: 10px 0;"><strong>Шаг 3:</strong> Выберите свою роль (Заказчик или Водитель)</p>
                        <p style="margin: 10px 0;"><strong>Шаг 4:</strong> Вернитесь и обновите это приложение</p>
                    </div>

                    <button class="btn-primary" onclick="window.Telegram.WebApp.close()" style="width: 100%; padding: 16px; font-size: 16px; margin-top: 20px;">
                        Закрыть и перейти в бота
                    </button>
                </div>
            </div>
        </div>

        <!-- Главный экран приложения -->
        <div id="main-screen" class="screen hidden">
            <!-- Профиль пользователя -->
            <div class="profile-card" id="profile-card" onclick="openProfile()">
                <div class="profile-avatar" id="user-avatar"></div>
                <div class="profile-info">
                    <div class="profile-name" id="user-name">Пользователь</div>
                    <div class="profile-phone" id="user-phone">+7 (000) 000-00-00</div>
                    <div class="profile-rating" id="user-rating">
                        <span class="rating-stars">★★★★★</span>
                        <span class="rating-value">0.0</span>
                    </div>
                </div>
                <button class="admin-contact-btn" onclick="contactAdmin(); event.stopPropagation();">
                    !
                </button>
            </div>

            <!-- Навигационное меню -->
            <nav class="nav-menu" id="nav-menu">
                <!-- Пункты меню добавляются динамически -->
            </nav>

            <!-- Контент вкладок -->
            <div class="tab-content" id="tab-content">
                <!-- Контент добавляется динамически -->
            </div>

            <!-- Кнопка создания заявки (для заказчиков) -->
            <button class="fab" id="create-order-btn">
                <span class="fab-icon">+</span>
            </button>
        </div>
        
        <!-- Экран профиля пользователя -->
        <div id="profile-screen" class="screen hidden">
            <div class="profile-header">
                <button class="back-btn" onclick="closeProfile()">← Назад</button>
                <h2>Профиль</h2>
            </div>
            
            <div class="profile-details-card">
                <div class="profile-avatar-large" id="profile-avatar-large"></div>
                <div class="profile-name-large" id="profile-name-large">Пользователь</div>
                <div class="profile-phone-large" id="profile-phone-large">+7 (000) 000-00-00</div>
                <div class="profile-role-large" id="profile-role-large">Заказчик</div>
                
                <div class="profile-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="stat-orders">0</div>
                        <div class="stat-label">Заказов</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-rating">
                            <span class="rating-stars-large">★★★★★</span>
                            <span id="stat-rating-value">0.0</span>
                        </div>
                        <div class="stat-label">Рейтинг</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="stat-reviews">0</div>
                        <div class="stat-label">Отзывов</div>
                    </div>
                </div>
            </div>
            
            <div class="reviews-section">
                <h3>Отзывы</h3>
                <div id="reviews-list">
                    <!-- Список отзывов -->
                </div>
            </div>
        </div>

        <!-- Модальное окно создания заявки -->
        <div id="create-order-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Создать заявку</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="create-order-form">
                        <div class="form-group">
                            <label>Тип грузовика</label>
                            <select id="truck-type" required>
                                <option value="">Выберите тип</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label>Откуда</label>
                            <input type="text" id="pickup-location" placeholder="Адрес загрузки" required>
                        </div>

                        <div class="form-group">
                            <label>Куда</label>
                            <input type="text" id="delivery-location" placeholder="Адрес выгрузки" required>
                        </div>

                        <div class="form-group">
                            <label>Описание груза</label>
                            <textarea id="description" rows="3" placeholder="Что нужно перевезти" required></textarea>
                        </div>

                        <div class="form-row">
                            <div class="form-group">
                                <label>Вес (кг)</label>
                                <input type="number" id="cargo-weight" placeholder="Необязательно">
                            </div>
                            <div class="form-group">
                                <label>Объем (м³)</label>
                                <input type="number" id="cargo-volume" step="0.1" placeholder="Необязательно">
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Желаемая цена (руб)</label>
                            <input type="number" id="price" placeholder="Необязательно">
                        </div>

                        <div class="form-group">
                            <label>Дата доставки</label>
                            <input type="date" id="delivery-date" placeholder="Необязательно">
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-order">Отмена</button>
                            <button type="submit" class="btn btn-primary">Создать</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Модальное окно предложения (для водителей) -->
        <div id="create-bid-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Сделать предложение</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="bid-order-info" class="order-info-card">
                        <!-- Информация о заказе -->
                    </div>
                    <form id="create-bid-form">
                        <div class="form-group">
                            <label>Ваша цена (руб)</label>
                            <input type="number" id="bid-price" min="1" required>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-bid">Отмена</button>
                            <button type="submit" class="btn btn-primary">Отправить</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>

        <!-- Модальное окно просмотра предложений -->
        <div id="view-bids-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Предложения</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div id="bids-list">
                        <!-- Список предложений -->
                    </div>
                </div>
            </div>
        </div>

        <!-- Модальное окно отмены заявки -->
        <div id="cancel-order-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Отмена заявки</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <form id="cancel-order-form">
                        <div class="form-group">
                            <label>Укажите причину отмены</label>
                            <textarea id="cancellation-reason" rows="4" placeholder="Введите причину отмены заявки" required></textarea>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-cancellation">Отмена</button>
                            <button type="submit" class="btn btn-danger">Подтвердить отмену</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
        
        <!-- Модальное окно оценки заказа -->
        <div id="review-modal" class="modal hidden">
            <div class="modal-overlay"></div>
            <div class="modal-content">
                <div class="modal-header">
                    <h2>Оценить выполнение</h2>
                    <button class="modal-close">&times;</button>
                </div>
                <div class="modal-body">
                    <div class="review-user-info">
                        <div class="review-avatar" id="review-avatar"></div>
                        <div class="review-user-name" id="review-user-name">Пользователь</div>
                    </div>
                    
                    <form id="review-form">
                        <input type="hidden" id="review-order-id">
                        <input type="hidden" id="review-user-id">
                        
                        <div class="form-group">
                            <label>Ваша оценка</label>
                            <div class="rating-input" id="rating-input">
                                <span class="rating-star" data-rating="1">★</span>
                                <span class="rating-star" data-rating="2">★</span>
                                <span class="rating-star" data-rating="3">★</span>
                                <span class="rating-star" data-rating="4">★</span>
                                <span class="rating-star" data-rating="5">★</span>
                            </div>
                            <input type="hidden" id="rating-value" required>
                        </div>

                        <div class="form-group">
                            <label>Комментарий (необязательно)</label>
                            <textarea id="review-comment" rows="4" placeholder="Поделитесь своим опытом работы"></textarea>
                        </div>

                        <div class="modal-actions">
                            <button type="button" class="btn btn-secondary" id="cancel-review">Отмена</button>
                            <button type="submit" class="btn btn-primary">Оставить отзыв</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="static/js/app.js?v={{ version }}"></script>
</body>
</html>
